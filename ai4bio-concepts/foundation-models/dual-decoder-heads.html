<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TranscriptFormer Dual Decoder Heads - AI4Bio Concepts</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Lato', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e8d5d9 100%);
            line-height: 1.8;
            color: #333;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .navbar {
            background-color: #ffffff;
            border-bottom: 1px solid #e7e7e7;
            padding: 10px 0;
        }
        .navbar-nav {
            list-style-type: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .navbar-nav li {
            margin: 0 15px;
        }
        .navbar-nav a {
            color: #666666;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
        }
        .home-link {
            color: #B01C3C !important;
        }
        .header {
            background: linear-gradient(135deg, #7D1439 0%, #8F193E 50%, #B01C3C 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin: 30px 0;
            text-align: center;
        }
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            color: white;
        }
        .header p {
            margin: 5px 0;
            font-size: 1.1em;
            color: #f0e5e8;
        }
        .tldr-box {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 5px solid #f0e5e8;
        }
        .tldr-box h3 {
            margin-top: 0;
            color: white;
        }
        .content-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(125, 20, 57, 0.15);
        }
        .content-section h2 {
            color: #7D1439;
            border-bottom: 3px solid #B01C3C;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .content-section h3 {
            color: #8F193E;
            margin-top: 25px;
        }
        
        .analogy-box {
            background: linear-gradient(135deg, #8F193E 0%, #B01C3C 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .analogy-box h3 {
            color: white;
            margin-top: 0;
        }
        
        .simple-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .flow-step {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            min-width: 140px;
            box-shadow: 0 4px 10px rgba(125, 20, 57, 0.1);
        }
        
        .flow-step .number {
            background: #B01C3C;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .flow-arrow {
            font-size: 2em;
            color: #8F193E;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-top: 4px solid #B01C3C;
        }
        
        .comparison-card.decoder2 {
            border-top-color: #7D1439;
        }
        
        .visual-example {
            background: linear-gradient(135deg, #7D1439 0%, #8F193E 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
        }
        
        .cell-sentence {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
        }
        
        .token {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 20px;
            background: rgba(255,255,255,0.3);
        }
        
        .token.gene {
            background: #B01C3C;
            color: white;
        }
        
        .token.count {
            background: #7D1439;
            color: white;
        }
        
        .interactive-demo {
            background: linear-gradient(135deg, #7D1439 0%, #8F193E 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
        }
        
        .demo-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 12px 25px;
            border-radius: 25px;
            margin: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            font-weight: bold;
        }
        
        .demo-button:hover {
            background: rgba(255,255,255,0.4);
            transform: translateY(-2px);
        }
        
        .demo-button.active {
            background: white;
            color: #7D1439;
        }
        
        .demo-output {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            min-height: 150px;
        }
        
        .concept-box {
            background: #f8f9fa;
            border-left: 5px solid #B01C3C;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .highlight-box {
            background: #fff3cd;
            border: 2px solid #B01C3C;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .back-link {
            display: inline-block;
            margin: 20px 0;
            padding: 12px 25px;
            background: #B01C3C;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .back-link:hover {
            background: #8F193E;
            transform: translateX(-5px);
        }

        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }
            .simple-flow {
                flex-direction: column;
            }
            .flow-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <ul class="navbar-nav">
                <li><a href="../index.html" class="home-link"><i class="fas fa-book"></i> AI4Bio Concepts Handbook</a></li>
                <li><a href="../../"><i class="fas fa-home"></i> Xinru's Homepage</a></li>
            </ul>
        </div>
    </nav>

    <main role="main">
        <div class="container">
            <div class="header">
                <h1><i class="fas fa-project-diagram"></i> TranscriptFormer Dual Decoder Heads</h1>
                <p>How AI generates realistic cell profiles by predicting genes AND their expression levels</p>
                
                <div class="tldr-box">
                    <h3><i class="fas fa-lightbulb"></i> The Big Idea</h3>
                    <p>Think of it like autocomplete for cells: the model predicts both <strong>which gene</strong> comes next (like suggesting a word) and <strong>how much</strong> it's expressed (like choosing how bold to make that word). Two specialized "heads" work together to make these predictions realistic.</p>
                </div>
            </div>

            <!-- Start with Analogy -->
            <div class="content-section">
                <h2><i class="fas fa-book-open"></i> Understanding Through Analogy</h2>
                
                <div class="analogy-box">
                    <h3>🎨 Imagine You're Writing a Recipe</h3>
                    <p><strong>First Decision:</strong> What ingredient comes next? (flour, sugar, eggs...)</p>
                    <p><strong>Second Decision:</strong> How much of it? (2 cups, 1 tablespoon, 3 eggs...)</p>
                    <p>The dual decoder works the same way:</p>
                    <ul>
                        <li><strong>Gene Decoder:</strong> Picks which gene (ingredient)</li>
                        <li><strong>Count Decoder:</strong> Decides how much (quantity)</li>
                    </ul>
                    <p>Just like a good recipe needs both the right ingredients AND the right amounts, a realistic cell profile needs both the right genes AND their correct expression levels!</p>
                </div>
            </div>

            <!-- Visual Process -->
            <div class="content-section">
                <h2><i class="fas fa-stream"></i> How It Works: Step by Step</h2>
                
                <div class="simple-flow">
                    <div class="flow-step">
                        <div class="number">1</div>
                        <h4>Input Context</h4>
                        <p>Previous genes in cell</p>
                    </div>
                    
                    <div class="flow-arrow">→</div>
                    
                    <div class="flow-step">
                        <div class="number">2</div>
                        <h4>Transformer</h4>
                        <p>Understands context</p>
                    </div>
                    
                    <div class="flow-arrow">→</div>
                    
                    <div class="flow-step">
                        <div class="number">3</div>
                        <h4>Gene Decoder</h4>
                        <p>Picks next gene</p>
                    </div>
                    
                    <div class="flow-arrow">→</div>
                    
                    <div class="flow-step">
                        <div class="number">4</div>
                        <h4>Count Decoder</h4>
                        <p>Predicts expression</p>
                    </div>
                </div>

                <div class="visual-example">
                    <h3>📊 Example: Generating a Cell Profile</h3>
                    <div class="cell-sentence">
                        <strong>Cell Sentence Being Generated:</strong><br><br>
                        [START] → 
                        <span class="token gene">GAPDH</span>
                        <span class="token count">[156]</span> →
                        <span class="token gene">ACTB</span>
                        <span class="token count">[89]</span> →
                        <span class="token gene">TP53</span>
                        <span class="token count">[23]</span> → ...
                    </div>
                    <p style="margin-top: 15px;">
                        Each step adds a new <span style="background: #B01C3C; padding: 3px 8px; border-radius: 5px; color: white;">gene</span> with its 
                        <span style="background: #7D1439; padding: 3px 8px; border-radius: 5px; color: white;">expression count</span>
                    </p>
                </div>
            </div>

            <!-- The Two Decoders -->
            <div class="content-section">
                <h2><i class="fas fa-code-branch"></i> The Two Decoder Heads Explained</h2>
                
                <div class="comparison-grid">
                    <div class="comparison-card">
                        <h3><i class="fas fa-dna"></i> Gene Decoder</h3>
                        <p><strong>Job:</strong> Pick which gene comes next</p>
                        <p><strong>How:</strong> Looks at ~50,000 possible genes and assigns each a probability</p>
                        <p><strong>Output:</strong> One gene (e.g., "GAPDH")</p>
                        <p><strong>Like:</strong> Autocomplete suggesting words</p>
                        <div style="margin-top: 15px; padding: 10px; background: #B01C3C; color: white; border-radius: 8px;">
                            <strong>Example:</strong><br>
                            GAPDH: 23%<br>
                            ACTB: 18%<br>
                            TP53: 12%<br>
                            Others: 47%
                        </div>
                    </div>
                    
                    <div class="comparison-card decoder2">
                        <h3><i class="fas fa-chart-bar"></i> Count Decoder</h3>
                        <p><strong>Job:</strong> Decide how much it's expressed</p>
                        <p><strong>How:</strong> Uses statistical model (Zero-Truncated Poisson) to predict realistic counts</p>
                        <p><strong>Output:</strong> A number (e.g., 156 copies)</p>
                        <p><strong>Like:</strong> Deciding font size/boldness</p>
                        <div style="margin-top: 15px; padding: 10px; background: #7D1439; color: white; border-radius: 8px;">
                            <strong>Example:</strong><br>
                            For gene GAPDH:<br>
                            Predicted count: <strong>156</strong><br>
                            (High because it's a housekeeping gene)
                        </div>
                    </div>
                </div>

                <div class="highlight-box">
                    <strong><i class="fas fa-check-circle"></i> Why Both Are Needed:</strong>
                    <p>Different genes have different typical expression levels. GAPDH (housekeeping) might have 150+ copies, while TP53 (regulatory) might have only 20. The model learns these patterns by training both decoders together.</p>
                </div>
            </div>

            <!-- Interactive Demo -->
            <div class="content-section">
                <h2><i class="fas fa-gamepad"></i> Try It Yourself</h2>
                
                <div class="interactive-demo">
                    <h3>🎮 Interactive Cell Generation Demo</h3>
                    <p>Click through the steps to see how the dual decoders work together</p>
                    
                    <div style="margin: 25px 0;">
                        <button class="demo-button" id="step1-btn">Step 1: Transformer Encodes Context</button>
                        <button class="demo-button" id="step2-btn">Step 2: Gene Decoder Picks Gene</button>
                        <button class="demo-button" id="step3-btn">Step 3: Count Decoder Sets Expression</button>
                        <button class="demo-button" id="reset-btn">Reset</button>
                    </div>
                    
                    <div class="demo-output" id="demo-display">
                        <div style="font-size: 1.2em;"><strong>Current Cell Sentence:</strong></div>
                        <div id="sentence-display" style="margin: 20px 0; font-size: 1.1em;">
                            🧬 [START] → <span style="color: #aaa;">waiting...</span>
                        </div>
                        <div id="decoder-info"></div>
                    </div>
                </div>
            </div>

            <!-- Why This Matters -->
            <div class="content-section">
                <h2><i class="fas fa-star"></i> Why This Design Is Powerful</h2>
                
                <div class="concept-box">
                    <h3>🎯 Key Advantages</h3>
                    
                    <p><strong>1. Biological Realism</strong></p>
                    <p>By modeling both identity and quantity, generated cells look like real cells under a microscope.</p>
                    
                    <p><strong>2. Context Awareness</strong></p>
                    <p>The model knows that if it already picked several immune genes, it should probably pick more immune genes (and avoid neuron genes).</p>
                    
                    <p><strong>3. Efficiency</strong></p>
                    <p>One shared transformer feeds both decoders, rather than needing two separate models.</p>
                    
                    <p><strong>4. Joint Learning</strong></p>
                    <p>Training both tasks together makes each one better. The gene decoder learns which genes appear together, and the count decoder learns typical expression levels.</p>
                </div>

                <div class="highlight-box">
                    <strong><i class="fas fa-flask"></i> Real-World Impact:</strong>
                    <p>This architecture enables scientists to:</p>
                    <ul>
                        <li>Simulate rare cell types for research</li>
                        <li>Predict how cells respond to drugs</li>
                        <li>Generate training data for other AI models</li>
                        <li>Model cell differentiation and development</li>
                    </ul>
                </div>
            </div>

            <!-- Technical Deep Dive (Optional) -->
            <div class="content-section">
                <h2><i class="fas fa-graduation-cap"></i> For the Technically Curious</h2>
                
                <details>
                    <summary style="cursor: pointer; font-weight: bold; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                        <i class="fas fa-plus-circle"></i> Mathematical Details
                    </summary>
                    <div style="margin-top: 15px;">
                        <h3>Gene Decoder Formula</h3>
                        <div style="background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 8px; font-family: monospace;">
                            ω<sub>j</sub> = softmax(MLP<sub>ω</sub>(z<sub>j</sub><sup>(L)</sup>))
                        </div>
                        <p>This creates a probability distribution over all genes based on the transformer's output.</p>
                        
                        <h3>Count Decoder Formula</h3>
                        <div style="background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 8px; font-family: monospace;">
                            P(c = k | λ) = (λ<sup>k</sup> e<sup>-λ</sup>) / (k!(1 - e<sup>-λ</sup>)), k ≥ 1
                        </div>
                        <p>Zero-Truncated Poisson ensures counts are always positive (you can't express 0 copies of a gene that's in the sequence!).</p>
                    </div>
                </details>

                <details style="margin-top: 15px;">
                    <summary style="cursor: pointer; font-weight: bold; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                        <i class="fas fa-plus-circle"></i> Training Process
                    </summary>
                    <div style="margin-top: 15px;">
                        <ol>
                            <li><strong>Input:</strong> Real cell profiles from experiments</li>
                            <li><strong>Forward Pass:</strong> Predict genes and counts</li>
                            <li><strong>Compute Loss:</strong> Compare predictions to actual data</li>
                            <li><strong>Backpropagation:</strong> Adjust model weights</li>
                            <li><strong>Repeat:</strong> Do this millions of times until predictions are accurate</li>
                        </ol>
                        <p>The combined loss function is: L = L<sub>gene</sub> + L<sub>count</sub></p>
                    </div>
                </details>
            </div>

            <!-- Key Takeaways -->
            <div class="content-section">
                <h2><i class="fas fa-key"></i> Key Takeaways</h2>
                
                <div class="concept-box" style="border-left-color: #8F193E;">
                    <h3>Remember These Points:</h3>
                    <ul style="font-size: 1.1em; line-height: 2;">
                        <li>🎯 <strong>Two decoders, two jobs:</strong> one picks genes, one sets expression levels</li>
                        <li>🔗 <strong>They work together:</strong> trained jointly with shared knowledge</li>
                        <li>🧬 <strong>Generates realistic cells:</strong> both identity and quantity matter</li>
                        <li>⚡ <strong>Efficient design:</strong> one transformer feeds both decoders</li>
                        <li>🔬 <strong>Powerful applications:</strong> from drug discovery to cell simulation</li>
                    </ul>
                </div>
            </div>

            <a href="../index.html" class="back-link">
                <i class="fas fa-arrow-left"></i> Back to AI4Bio Concepts Handbook
            </a>
        </div>
    </main>

    <script>
        let demoStep = 0;
        const genes = [
            {name: 'GAPDH', count: 156, prob: 0.23},
            {name: 'ACTB', count: 89, prob: 0.18},
            {name: 'TP53', count: 23, prob: 0.12},
            {name: 'MYC', count: 45, prob: 0.15}
        ];
        let selectedGene = null;

        function resetDemo() {
            demoStep = 0;
            selectedGene = null;
            document.getElementById('sentence-display').innerHTML = '🧬 [START] → <span style="color: #aaa;">waiting...</span>';
            document.getElementById('decoder-info').innerHTML = '';
            document.querySelectorAll('.demo-button').forEach(btn => btn.classList.remove('active'));
        }

        document.getElementById('step1-btn').addEventListener('click', function() {
            if (demoStep !== 0) return;
            demoStep = 1;
            this.classList.add('active');
            
            document.getElementById('decoder-info').innerHTML = `
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.3); border-radius: 8px;">
                    <strong>🧠 Transformer Processing...</strong><br>
                    Analyzing context: [START] token<br>
                    Creating representation vector for both decoders<br>
                    <div style="margin-top: 10px; color: #90EE90;">✓ Context encoded successfully!</div>
                </div>
            `;
        });

        document.getElementById('step2-btn').addEventListener('click', function() {
            if (demoStep !== 1) {
                alert('Please complete Step 1 first!');
                return;
            }
            demoStep = 2;
            this.classList.add('active');
            
            selectedGene = genes[Math.floor(Math.random() * genes.length)];
            
            document.getElementById('sentence-display').innerHTML = `
                🧬 [START] → <span class="token gene">${selectedGene.name}</span>
            `;
            
            document.getElementById('decoder-info').innerHTML = `
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.3); border-radius: 8px;">
                    <strong>🧬 Gene Decoder Output:</strong><br>
                    <div style="margin-top: 10px;">
                        Top predictions:<br>
                        ${genes.map(g => `
                            <div style="margin: 5px 0;">
                                ${g.name}: ${(g.prob * 100).toFixed(1)}% 
                                ${g.name === selectedGene.name ? '<span style="color: #90EE90;">← Selected!</span>' : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        });

        document.getElementById('step3-btn').addEventListener('click', function() {
            if (demoStep !== 2) {
                alert('Please complete Steps 1 and 2 first!');
                return;
            }
            demoStep = 3;
            this.classList.add('active');
            
            document.getElementById('sentence-display').innerHTML = `
                🧬 [START] → 
                <span class="token gene">${selectedGene.name}</span>
                <span class="token count">[${selectedGene.count}]</span>
            `;
            
            document.getElementById('decoder-info').innerHTML = `
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.3); border-radius: 8px;">
                    <strong>📊 Count Decoder Output:</strong><br>
                    <div style="margin-top: 10px;">
                        Gene: ${selectedGene.name}<br>
                        Predicted expression count: <strong>${selectedGene.count}</strong><br>
                        Rate parameter (λ): ${(selectedGene.count * 0.8).toFixed(1)}<br>
                        <div style="margin-top: 10px; color: #90EE90;">
                            ✓ Complete! This gene-count pair is now part of the cell profile.
                        </div>
                    </div>
                </div>
            `;
        });

        document.getElementById('reset-btn').addEventListener('click', resetDemo);
    </script>
</body>
</html>
